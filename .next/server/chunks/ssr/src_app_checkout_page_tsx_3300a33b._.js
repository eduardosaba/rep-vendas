module.exports=[94894,a=>{"use strict";var b=a.i(92552),c=a.i(63206),d=a.i(88045),e=a.i(55875),f=a.i(63535);let g=(0,f.default)("credit-card",[["rect",{width:"20",height:"14",x:"2",y:"5",rx:"2",key:"ynyp8z"}],["line",{x1:"2",x2:"22",y1:"10",y2:"10",key:"1b3vmo"}]]);var h=a.i(17601),i=a.i(52240);let j=(0,f.default)("map-pin",[["path",{d:"M20 10c0 4.993-5.539 10.193-7.399 11.799a1 1 0 0 1-1.202 0C9.539 20.193 4 14.993 4 10a8 8 0 0 1 16 0",key:"1r0f0z"}],["circle",{cx:"12",cy:"10",r:"3",key:"ilqhr7"}]]),k=(0,f.default)("user",[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]]);var l=a.i(24744);function m(){let[a,f]=(0,c.useState)({}),[m,n]=(0,c.useState)([]),[o,p]=(0,c.useState)(null),[q,r]=(0,c.useState)([]),[s,t]=(0,c.useState)(""),[u,v]=(0,c.useState)(!0),[w,x]=(0,c.useState)(!1),[y,z]=(0,c.useState)(!1),A=(0,e.useRouter)(),[B,C]=(0,c.useState)({client_name:"",client_email:"",client_phone:"",delivery_address:"",payment_method:"boleto",notes:""});(0,c.useEffect)(()=>{D(),F(),G()},[]),(0,c.useEffect)(()=>{Object.keys(a).length>0?E():(n([]),v(!1))},[a]);let D=()=>{let a=localStorage.getItem("cart");a?f(JSON.parse(a)):v(!1)},E=async()=>{let b=Object.keys(a),{data:c}=await d.supabase.from("products").select("*").in("id",b);c&&n(c.map(b=>({product:b,quantity:a[b.id]||0}))),v(!1)},F=async()=>{let{data:a}=await d.supabase.from("settings").select("*").limit(1);a&&a.length>0&&p(a[0])},G=async()=>{let{data:{user:a}}=await d.supabase.auth.getUser();if(a){let{data:b}=await d.supabase.from("clients").select("*").eq("user_id",a.id).order("name");r(b||[])}},H=()=>m.reduce((a,b)=>a+b.product.price*b.quantity,0),I=()=>Object.values(a).reduce((a,b)=>a+b,0),J=async a=>{a.preventDefault(),x(!0);try{let{data:{user:a}}=await d.supabase.auth.getUser();if(!a)return void alert("Usuário não autenticado");let b={user_id:a.id,client_id:s||null,status:"Pendente",total_value:H(),order_type:"catalog",delivery_address:B.delivery_address,payment_method:B.payment_method,notes:B.notes,order_items:m.map(a=>({product_id:a.product.id,quantity:a.quantity,unit_price:a.product.price,total_price:a.product.price*a.quantity}))},{data:c,error:e}=await d.supabase.from("orders").insert({user_id:b.user_id,client_id:b.client_id,status:b.status,total_value:b.total_value,order_type:b.order_type,delivery_address:b.delivery_address,payment_method:b.payment_method,notes:b.notes}).select().single();if(e)throw e;let f=b.order_items.map(a=>({order_id:c.id,...a})),{error:g}=await d.supabase.from("order_items").insert(f);if(g)throw g;try{await fetch("/api/notifications",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({userId:a.id,title:"Novo Pedido Recebido",message:`Pedido #${c.id.slice(-8).toUpperCase()} foi criado com sucesso. Valor: R$ ${H().toFixed(2)}`,type:"success",data:{orderId:c.id,orderNumber:c.id.slice(-8).toUpperCase(),totalValue:H(),clientName:B.client_name}})})}catch(a){console.error("Erro ao criar notificação:",a)}if(B.client_email)try{let b=`
            <div style="font-family: Arial, sans-serif; max-width: 600px; margin: 0 auto;">
              <h1 style="color: #333; text-align: center;">Pedido Recebido!</h1>
              <p>Ol\xe1 ${B.client_name},</p>
              <p>Seu pedido foi recebido com sucesso e est\xe1 sendo processado.</p>

              <div style="background: #f8f9fa; padding: 20px; margin: 20px 0; border-radius: 8px;">
                <h3>Detalhes do Pedido:</h3>
                <p><strong>N\xfamero do Pedido:</strong> #${c.id.slice(-8).toUpperCase()}</p>
                <p><strong>Data:</strong> ${new Date().toLocaleDateString("pt-BR")}</p>
                <p><strong>Valor Total:</strong> R$ ${H().toFixed(2)}</p>
                <p><strong>Forma de Pagamento:</strong> ${"boleto"===B.payment_method?"Boleto Bancário":"pix"===B.payment_method?"PIX":"Cartão de Crédito"}</p>
              </div>

              <div style="background: #f8f9fa; padding: 20px; margin: 20px 0; border-radius: 8px;">
                <h3>Itens do Pedido:</h3>
                ${m.map(a=>`
                  <div style="border-bottom: 1px solid #dee2e6; padding: 10px 0;">
                    <p><strong>${a.product.name}</strong></p>
                    <p>Quantidade: ${a.quantity} | Pre\xe7o: R$ ${a.product.price.toFixed(2)} | Total: R$ ${(a.product.price*a.quantity).toFixed(2)}</p>
                  </div>
                `).join("")}
              </div>

              <div style="background: #f8f9fa; padding: 20px; margin: 20px 0; border-radius: 8px;">
                <h3>Endere\xe7o de Entrega:</h3>
                <p>${B.delivery_address}</p>
              </div>

              ${B.notes?`
                <div style="background: #f8f9fa; padding: 20px; margin: 20px 0; border-radius: 8px;">
                  <h3>Observa\xe7\xf5es:</h3>
                  <p>${B.notes}</p>
                </div>
              `:""}

              <p>Em breve entraremos em contato para confirmar os detalhes do pedido.</p>
              <p>Atenciosamente,<br>Equipe Rep-Vendas</p>
            </div>
          `,d=`
            Pedido Recebido!

            Ol\xe1 ${B.client_name},

            Seu pedido foi recebido com sucesso e est\xe1 sendo processado.

            Detalhes do Pedido:
            N\xfamero do Pedido: #${c.id.slice(-8).toUpperCase()}
            Data: ${new Date().toLocaleDateString("pt-BR")}
            Valor Total: R$ ${H().toFixed(2)}
            Forma de Pagamento: ${"boleto"===B.payment_method?"Boleto Bancário":"pix"===B.payment_method?"PIX":"Cartão de Crédito"}

            Itens do Pedido:
            ${m.map(a=>`- ${a.product.name} (Qtd: ${a.quantity}) - R$ ${(a.product.price*a.quantity).toFixed(2)}`).join("\n")}

            Endere\xe7o de Entrega:
            ${B.delivery_address}

            ${B.notes?`Observa\xe7\xf5es: ${B.notes}`:""}

            Em breve entraremos em contato para confirmar os detalhes do pedido.

            Atenciosamente,
            Equipe Rep-Vendas
          `;await fetch("/api/send-email",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({to:B.client_email,subject:`Pedido #${c.id.slice(-8).toUpperCase()} - Rep-Vendas`,html:b,text:d,userId:a.id})})}catch(a){console.error("Erro ao enviar email:",a)}localStorage.removeItem("cart"),z(!0)}catch(a){console.error("Erro ao finalizar pedido:",a),alert("Erro ao finalizar pedido. Tente novamente.")}finally{x(!1)}};return u?(0,b.jsx)("div",{className:"min-h-screen bg-gray-100 flex items-center justify-center",children:(0,b.jsxs)("div",{className:"text-center",children:[(0,b.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto"}),(0,b.jsx)("p",{className:"mt-4 text-gray-600",children:"Carregando checkout..."})]})}):0!==m.length||y?y?(0,b.jsx)("div",{className:"min-h-screen bg-gray-100 flex items-center justify-center",children:(0,b.jsxs)("div",{className:"max-w-md w-full bg-white rounded-lg shadow-lg p-8 text-center",children:[(0,b.jsx)(i.CheckCircle,{className:"h-16 w-16 text-green-500 mx-auto mb-4"}),(0,b.jsx)("h2",{className:"text-2xl font-bold text-gray-900 mb-2",children:"Pedido Finalizado!"}),(0,b.jsx)("p",{className:"text-gray-600 mb-6",children:"Seu pedido foi criado com sucesso e está sendo processado."}),(0,b.jsxs)("div",{className:"space-y-3",children:[(0,b.jsx)("button",{onClick:()=>A.push("/dashboard"),className:"w-full bg-blue-600 text-white py-3 px-4 rounded-lg hover:bg-blue-700 transition-colors",style:{backgroundColor:o?.primary_color||"#3B82F6"},children:"Ver Meus Pedidos"}),(0,b.jsx)("button",{onClick:()=>A.push("/"),className:"w-full bg-gray-100 text-gray-700 py-3 px-4 rounded-lg hover:bg-gray-200 transition-colors",children:"Continuar Comprando"})]})]})}):(0,b.jsxs)("div",{className:"min-h-screen bg-gray-100",children:[(0,b.jsx)("header",{className:"bg-white border-b border-gray-200",style:{backgroundColor:o?.header_color||"#FFFFFF"},children:(0,b.jsx)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:(0,b.jsx)("div",{className:"flex items-center justify-between py-4",children:(0,b.jsxs)("div",{className:"flex items-center space-x-8",children:[(0,b.jsxs)("button",{onClick:()=>A.back(),className:"flex items-center text-gray-600 hover:text-gray-900",style:{color:o?.icon_color||"#4B5563"},children:[(0,b.jsx)(h.ArrowLeft,{className:"h-5 w-5 mr-2"}),"Voltar"]}),o?.logo_url?(0,b.jsx)("img",{src:o.logo_url,alt:"Logo",className:"h-14 w-auto"}):(0,b.jsx)("h1",{className:"text-2xl font-bold text-gray-900",style:{color:o?.title_color||"#111827",fontFamily:o?.font_family||"Inter, sans-serif"},children:"Rep-Vendas"})]})})})}),(0,b.jsxs)("div",{className:"max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[(0,b.jsxs)("div",{className:"mb-8",children:[(0,b.jsx)("h1",{className:"text-3xl font-bold text-gray-900 mb-2",children:"Finalizar Pedido"}),(0,b.jsxs)("p",{className:"text-gray-600",children:[I()," produto",I()>1?"s":""," • Total: R$ ",H().toFixed(2)]})]}),(0,b.jsxs)("form",{onSubmit:J,className:"grid grid-cols-1 lg:grid-cols-2 gap-8",children:[(0,b.jsxs)("div",{className:"space-y-6",children:[(0,b.jsxs)("div",{className:"bg-white p-6 rounded-lg shadow-sm",children:[(0,b.jsxs)("h2",{className:"text-lg font-medium text-gray-900 mb-4 flex items-center",children:[(0,b.jsx)(k,{className:"h-5 w-5 mr-2"}),"Dados do Cliente"]}),q.length>0&&(0,b.jsxs)("div",{className:"mb-4",children:[(0,b.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Selecionar cliente existente"}),(0,b.jsxs)("select",{value:s,onChange:a=>{var b;let c;return t(b=a.target.value),void((c=q.find(a=>a.id===b))&&C(a=>({...a,client_name:c.name,client_email:c.email||"",client_phone:c.phone||"",delivery_address:c.address||""})))},className:"w-full border border-gray-300 rounded px-3 py-2",children:[(0,b.jsx)("option",{value:"",children:"Novo cliente"}),q.map(a=>(0,b.jsx)("option",{value:a.id,children:a.name},a.id))]})]}),(0,b.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Nome *"}),(0,b.jsx)("input",{type:"text",required:!0,value:B.client_name,onChange:a=>C(b=>({...b,client_name:a.target.value})),className:"w-full border border-gray-300 rounded px-3 py-2",placeholder:"Nome completo"})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Email"}),(0,b.jsx)("input",{type:"email",value:B.client_email,onChange:a=>C(b=>({...b,client_email:a.target.value})),className:"w-full border border-gray-300 rounded px-3 py-2",placeholder:"email@exemplo.com"})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Telefone"}),(0,b.jsx)("input",{type:"tel",value:B.client_phone,onChange:a=>C(b=>({...b,client_phone:a.target.value})),className:"w-full border border-gray-300 rounded px-3 py-2",placeholder:"(11) 99999-9999"})]})]})]}),(0,b.jsxs)("div",{className:"bg-white p-6 rounded-lg shadow-sm",children:[(0,b.jsxs)("h2",{className:"text-lg font-medium text-gray-900 mb-4 flex items-center",children:[(0,b.jsx)(j,{className:"h-5 w-5 mr-2"}),"Endereço de Entrega"]}),(0,b.jsx)("div",{children:(0,b.jsx)("textarea",{required:!0,value:B.delivery_address,onChange:a=>C(b=>({...b,delivery_address:a.target.value})),className:"w-full border border-gray-300 rounded px-3 py-2 h-24",placeholder:"Endereço completo para entrega"})})]}),(0,b.jsxs)("div",{className:"bg-white p-6 rounded-lg shadow-sm",children:[(0,b.jsxs)("h2",{className:"text-lg font-medium text-gray-900 mb-4 flex items-center",children:[(0,b.jsx)(g,{className:"h-5 w-5 mr-2"}),"Forma de Pagamento"]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsxs)("label",{className:"flex items-center",children:[(0,b.jsx)("input",{type:"radio",value:"boleto",checked:"boleto"===B.payment_method,onChange:a=>C(b=>({...b,payment_method:a.target.value})),className:"mr-2"}),"Boleto Bancário"]}),(0,b.jsxs)("label",{className:"flex items-center",children:[(0,b.jsx)("input",{type:"radio",value:"pix",checked:"pix"===B.payment_method,onChange:a=>C(b=>({...b,payment_method:a.target.value})),className:"mr-2"}),"PIX"]}),(0,b.jsxs)("label",{className:"flex items-center",children:[(0,b.jsx)("input",{type:"radio",value:"cartao",checked:"cartao"===B.payment_method,onChange:a=>C(b=>({...b,payment_method:a.target.value})),className:"mr-2"}),"Cartão de Crédito"]})]})]}),(0,b.jsxs)("div",{className:"bg-white p-6 rounded-lg shadow-sm",children:[(0,b.jsx)("h2",{className:"text-lg font-medium text-gray-900 mb-4",children:"Observações"}),(0,b.jsx)("textarea",{value:B.notes,onChange:a=>C(b=>({...b,notes:a.target.value})),className:"w-full border border-gray-300 rounded px-3 py-2 h-24",placeholder:"Observações adicionais sobre o pedido"})]})]}),(0,b.jsxs)("div",{className:"space-y-6",children:[(0,b.jsxs)("div",{className:"bg-white p-6 rounded-lg shadow-sm",children:[(0,b.jsx)("h2",{className:"text-lg font-medium text-gray-900 mb-4",children:"Itens do Pedido"}),(0,b.jsx)("div",{className:"space-y-4",children:m.map(a=>(0,b.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,b.jsx)("div",{className:"w-16 h-16 flex-shrink-0",children:a.product.image_url?(0,b.jsx)("img",{src:a.product.image_url,alt:a.product.name,className:"w-full h-full object-cover rounded"}):(0,b.jsx)("div",{className:"w-full h-full bg-gray-100 rounded flex items-center justify-center",children:(0,b.jsx)("span",{className:"text-gray-400 text-xs",children:"Sem imagem"})})}),(0,b.jsxs)("div",{className:"flex-1",children:[(0,b.jsx)("h3",{className:"text-sm font-medium text-gray-900",children:a.product.name}),(0,b.jsx)("p",{className:"text-sm text-gray-600",children:a.product.brand||"Marca"}),(0,b.jsxs)("p",{className:"text-sm text-gray-600",children:["Qtd: ",a.quantity]})]}),(0,b.jsx)("div",{className:"text-right",children:(0,b.jsxs)("p",{className:"text-sm font-medium text-gray-900",children:["R$ ",(a.product.price*a.quantity).toFixed(2)]})})]},a.product.id))})]}),(0,b.jsxs)("div",{className:"bg-white p-6 rounded-lg shadow-sm",children:[(0,b.jsx)("h2",{className:"text-lg font-medium text-gray-900 mb-4",children:"Resumo do Pedido"}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,b.jsxs)("span",{className:"text-gray-600",children:["Subtotal (",I()," itens)"]}),(0,b.jsxs)("span",{className:"text-gray-900",children:["R$ ",H().toFixed(2)]})]}),(0,b.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,b.jsx)("span",{className:"text-gray-600",children:"Frete"}),(0,b.jsx)("span",{className:"text-green-600",children:"Grátis"})]}),(0,b.jsx)("div",{className:"border-t border-gray-200 pt-2",children:(0,b.jsxs)("div",{className:"flex justify-between text-lg font-medium",children:[(0,b.jsx)("span",{className:"text-gray-900",children:"Total"}),(0,b.jsxs)("span",{className:"text-gray-900",children:["R$ ",H().toFixed(2)]})]})})]}),(0,b.jsx)("button",{type:"submit",disabled:w,className:"w-full mt-6 bg-blue-600 text-white py-3 px-4 rounded-lg text-sm font-medium hover:bg-blue-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",style:{backgroundColor:o?.primary_color||"#3B82F6"},children:w?(0,b.jsxs)("div",{className:"flex items-center justify-center",children:[(0,b.jsx)("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"}),"Processando..."]}):"Finalizar Pedido"})]})]})]})]})]}):(0,b.jsx)("div",{className:"min-h-screen bg-gray-100",children:(0,b.jsx)("div",{className:"max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:(0,b.jsxs)("div",{className:"text-center py-16",children:[(0,b.jsx)(l.ShoppingCart,{className:"h-24 w-24 text-gray-300 mx-auto mb-4"}),(0,b.jsx)("h3",{className:"text-xl font-medium text-gray-900 mb-2",children:"Carrinho vazio"}),(0,b.jsx)("p",{className:"text-gray-600 mb-6",children:"Adicione produtos ao carrinho antes de finalizar o pedido."}),(0,b.jsx)("button",{onClick:()=>A.push("/"),className:"bg-blue-600 text-white px-6 py-3 rounded-lg hover:bg-blue-700 transition-colors",style:{backgroundColor:o?.primary_color||"#3B82F6"},children:"Voltar ao Catálogo"})]})})})}a.s(["default",()=>m],94894)}];

//# sourceMappingURL=src_app_checkout_page_tsx_3300a33b._.js.map