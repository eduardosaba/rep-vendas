module.exports=[94894,a=>{"use strict";var b=a.i(92552),c=a.i(63206),d=a.i(88045),e=a.i(55875),f=a.i(72446),g=a.i(17601),h=a.i(52240),i=a.i(24031),j=a.i(4606),k=a.i(24744);function l(){let[a,l]=(0,c.useState)({}),[m,n]=(0,c.useState)([]),[o,p]=(0,c.useState)(null),[q,r]=(0,c.useState)(!0),[s,t]=(0,c.useState)(!1),[u,v]=(0,c.useState)(!1),w=(0,e.useRouter)(),[x,y]=(0,c.useState)({company_name:"",client_name:"",client_email:"",client_phone:"",delivery_address:"",payment_method:"boleto",notes:""}),[z,A]=(0,c.useState)("");(0,c.useEffect)(()=>{B(),D()},[]),(0,c.useEffect)(()=>{Object.keys(a).length>0?C():(n([]),r(!1))},[a]);let B=()=>{let a=localStorage.getItem("cart");a?l(JSON.parse(a)):r(!1)},C=async()=>{let b=Object.keys(a),{data:c}=await d.supabase.from("products").select("*").in("id",b);c&&n(c.map(b=>({product:b,quantity:a[b.id]||0}))),r(!1)},D=async()=>{let{data:a}=await d.supabase.from("settings").select("*").limit(1);a&&a.length>0&&p(a[0])},E=()=>m.reduce((a,b)=>a+b.product.price*b.quantity,0),F=()=>Object.values(a).reduce((a,b)=>a+b,0),G=async a=>{a.preventDefault(),t(!0);try{let{data:{user:a}}=await d.supabase.auth.getUser();if(!a)return void alert("Usuário não autenticado");let b=z;if(!z&&x.client_name.trim()){let{data:c,error:e}=await d.supabase.from("clients").insert({user_id:a.id,name:x.client_name.trim(),email:x.client_email?.trim()||null,phone:x.client_phone?.trim()||null}).select().single();if(e)throw e;b=c.id}let c={user_id:a.id,client_id:b,status:"Pendente",total_value:E(),order_type:"catalog",company_name:x.company_name,delivery_address:x.delivery_address,payment_method:x.payment_method,notes:x.notes,order_items:m.map(a=>({product_id:a.product.id,quantity:a.quantity,unit_price:a.product.price,total_price:a.product.price*a.quantity}))},{data:e,error:f}=await d.supabase.from("orders").insert({user_id:c.user_id,client_id:c.client_id,status:c.status,total_value:c.total_value,order_type:c.order_type,company_name:c.company_name,delivery_address:c.delivery_address,payment_method:c.payment_method,notes:c.notes}).select().single();if(f)throw f;let g=c.order_items.map(a=>({order_id:e.id,...a})),{error:h}=await d.supabase.from("order_items").insert(g);if(h)throw h;try{await fetch("/api/notifications",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({userId:a.id,title:"Novo Pedido Recebido",message:`Pedido #${e.id.slice(-8).toUpperCase()} foi criado com sucesso. Valor: R$ ${E().toFixed(2)}`,type:"success",data:{orderId:e.id,orderNumber:e.id.slice(-8).toUpperCase(),totalValue:E(),clientName:x.client_name}})})}catch(a){console.error("Erro ao criar notificação:",a)}if(x.client_email)try{let b=`
            <div style="font-family: Arial, sans-serif; max-width: 600px; margin: 0 auto;">
              <h1 style="color: #333; text-align: center;">Pedido Recebido!</h1>
              <p>Ol\xe1 ${x.client_name},</p>
              <p>Seu pedido foi recebido com sucesso e est\xe1 sendo processado.</p>

              <div style="background: #f8f9fa; padding: 20px; margin: 20px 0; border-radius: 8px;">
                <h3>Detalhes do Pedido:</h3>
                <p><strong>N\xfamero do Pedido:</strong> #${e.id.slice(-8).toUpperCase()}</p>
                <p><strong>Data:</strong> ${new Date().toLocaleDateString("pt-BR")}</p>
                <p><strong>Valor Total:</strong> R$ ${E().toFixed(2)}</p>
                <p><strong>Forma de Pagamento:</strong> ${"boleto"===x.payment_method?"Boleto Bancário":"pix"===x.payment_method?"PIX":"Cartão de Crédito"}</p>
              </div>

              <div style="background: #f8f9fa; padding: 20px; margin: 20px 0; border-radius: 8px;">
                <h3>Itens do Pedido:</h3>
                ${m.map(a=>`
                  <div style="border-bottom: 1px solid #dee2e6; padding: 10px 0;">
                    <p><strong>${a.product.name}</strong></p>
                    <p>Quantidade: ${a.quantity} | Pre\xe7o: R$ ${a.product.price.toFixed(2)} | Total: R$ ${(a.product.price*a.quantity).toFixed(2)}</p>
                  </div>
                `).join("")}
              </div>

              ${o?.show_delivery_address?`
                <div style="background: #f8f9fa; padding: 20px; margin: 20px 0; border-radius: 8px;">
                  <h3>Endere\xe7o de Entrega:</h3>
                  <p>${x.delivery_address}</p>
                </div>
              `:""}

              ${x.notes?`
                <div style="background: #f8f9fa; padding: 20px; margin: 20px 0; border-radius: 8px;">
                  <h3>Observa\xe7\xf5es:</h3>
                  <p>${x.notes}</p>
                </div>
              `:""}

              <p>Em breve entraremos em contato para confirmar os detalhes do pedido.</p>
              <p>Atenciosamente,<br>Equipe Rep-Vendas</p>
            </div>
          `,c=`
            Pedido Recebido!

            Ol\xe1 ${x.client_name},

            Seu pedido foi recebido com sucesso e est\xe1 sendo processado.

            Detalhes do Pedido:
            N\xfamero do Pedido: #${e.id.slice(-8).toUpperCase()}
            Data: ${new Date().toLocaleDateString("pt-BR")}
            Valor Total: R$ ${E().toFixed(2)}
            Forma de Pagamento: ${"boleto"===x.payment_method?"Boleto Bancário":"pix"===x.payment_method?"PIX":"Cartão de Crédito"}

            Itens do Pedido:
            ${m.map(a=>`- ${a.product.name} (Qtd: ${a.quantity}) - R$ ${(a.product.price*a.quantity).toFixed(2)}`).join("\n")}

            ${o?.show_delivery_address?`Endere\xe7o de Entrega:
            ${x.delivery_address}`:""}

            ${x.notes?`Observa\xe7\xf5es: ${x.notes}`:""}

            Em breve entraremos em contato para confirmar os detalhes do pedido.

            Atenciosamente,
            Equipe Rep-Vendas
          `;await fetch("/api/send-email",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({to:x.client_email,subject:`Pedido #${e.id.slice(-8).toUpperCase()} - Rep-Vendas`,html:b,text:c,userId:a.id})})}catch(a){console.error("Erro ao enviar email:",a)}localStorage.removeItem("cart"),v(!0)}catch(a){console.error("Erro ao finalizar pedido:",a),alert("Erro ao finalizar pedido. Tente novamente.")}finally{t(!1)}};return q?(0,b.jsx)("div",{className:"min-h-screen bg-gray-100 flex items-center justify-center",children:(0,b.jsxs)("div",{className:"text-center",children:[(0,b.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto"}),(0,b.jsx)("p",{className:"mt-4 text-gray-600",children:"Carregando checkout..."})]})}):0!==m.length||u?u?(0,b.jsx)("div",{className:"min-h-screen bg-gray-100 flex items-center justify-center",children:(0,b.jsxs)("div",{className:"max-w-md w-full bg-white rounded-lg shadow-lg p-8 text-center",children:[(0,b.jsx)(h.CheckCircle,{className:"h-16 w-16 text-green-500 mx-auto mb-4"}),(0,b.jsx)("h2",{className:"text-2xl font-bold text-gray-900 mb-2",children:"Pedido Finalizado!"}),(0,b.jsx)("p",{className:"text-gray-600 mb-6",children:"Seu pedido foi criado com sucesso e está sendo processado."}),(0,b.jsxs)("div",{className:"space-y-3",children:[(0,b.jsx)("button",{onClick:()=>w.push("/dashboard"),className:"w-full bg-blue-600 text-white py-3 px-4 rounded-lg hover:bg-blue-700 transition-colors",style:{backgroundColor:o?.primary_color||"#3B82F6"},children:"Ver Meus Pedidos"}),(0,b.jsx)("button",{onClick:()=>w.push("/"),className:"w-full bg-gray-100 text-gray-700 py-3 px-4 rounded-lg hover:bg-gray-200 transition-colors",children:"Continuar Comprando"})]})]})}):(0,b.jsxs)("div",{className:"min-h-screen bg-gray-100",children:[(0,b.jsx)("header",{className:"bg-white border-b border-gray-200",style:{backgroundColor:o?.header_color||"#FFFFFF"},children:(0,b.jsx)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:(0,b.jsx)("div",{className:"flex items-center justify-between py-4",children:(0,b.jsxs)("div",{className:"flex items-center space-x-8",children:[(0,b.jsxs)("button",{onClick:()=>w.back(),className:"flex items-center text-gray-600 hover:text-gray-900",style:{color:o?.icon_color||"#4B5563"},children:[(0,b.jsx)(g.ArrowLeft,{className:"h-5 w-5 mr-2"}),"Voltar"]}),o?.logo_url?(0,b.jsx)("img",{src:o.logo_url,alt:"Logo",className:"h-14 w-auto"}):(0,b.jsx)("h1",{className:"text-2xl font-bold text-gray-900",style:{color:o?.title_color||"#111827",fontFamily:o?.font_family||"Inter, sans-serif"},children:"Rep-Vendas"})]})})})}),(0,b.jsxs)("div",{className:"max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[(0,b.jsxs)("div",{className:"mb-8",children:[(0,b.jsx)("h1",{className:"text-3xl font-bold text-gray-900 mb-2",children:"Finalizar Pedido"}),(0,b.jsxs)("p",{className:"text-gray-600",children:[F()," produto",F()>1?"s":""," • Total: R$ ",E().toFixed(2)]})]}),(0,b.jsxs)("form",{onSubmit:G,className:"grid grid-cols-1 lg:grid-cols-2 gap-8",children:[(0,b.jsxs)("div",{className:"space-y-6",children:[(0,b.jsxs)("div",{className:"bg-white p-6 rounded-lg shadow-sm",children:[(0,b.jsxs)("h2",{className:"text-lg font-medium text-gray-900 mb-4 flex items-center",children:[(0,b.jsx)(j.User,{className:"h-5 w-5 mr-2"}),"Dados do Pedido"]}),(0,b.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Nome da Empresa *"}),(0,b.jsx)("input",{type:"text",required:!0,value:x.company_name,onChange:a=>y(b=>({...b,company_name:a.target.value})),className:"w-full border border-gray-300 rounded px-3 py-2",placeholder:"Nome da empresa"})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Nome do Solicitante *"}),(0,b.jsx)("input",{type:"text",required:!0,value:x.client_name,onChange:a=>y(b=>({...b,client_name:a.target.value})),className:"w-full border border-gray-300 rounded px-3 py-2",placeholder:"Nome completo"})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Email"}),(0,b.jsx)("input",{type:"email",value:x.client_email,onChange:a=>y(b=>({...b,client_email:a.target.value})),className:"w-full border border-gray-300 rounded px-3 py-2",placeholder:"email@exemplo.com"})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Telefone"}),(0,b.jsx)("input",{type:"tel",value:x.client_phone,onChange:a=>y(b=>({...b,client_phone:a.target.value})),className:"w-full border border-gray-300 rounded px-3 py-2",placeholder:"(11) 99999-9999"})]})]})]}),o?.show_delivery_address_checkout===!1?null:(0,b.jsxs)("div",{className:"bg-white p-6 rounded-lg shadow-sm",children:[(0,b.jsxs)("h2",{className:"text-lg font-medium text-gray-900 mb-4 flex items-center",children:[(0,b.jsx)(i.MapPin,{className:"h-5 w-5 mr-2"}),"Endereço de Entrega"]}),(0,b.jsx)("div",{children:(0,b.jsx)("textarea",{required:!0,value:x.delivery_address,onChange:a=>y(b=>({...b,delivery_address:a.target.value})),className:"w-full border border-gray-300 rounded px-3 py-2 h-24",placeholder:"Endereço completo para entrega"})})]}),o?.show_payment_method_checkout===!1?null:(0,b.jsxs)("div",{className:"bg-white p-6 rounded-lg shadow-sm",children:[(0,b.jsxs)("h2",{className:"text-lg font-medium text-gray-900 mb-4 flex items-center",children:[(0,b.jsx)(f.CreditCard,{className:"h-5 w-5 mr-2"}),"Forma de Pagamento"]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsxs)("label",{className:"flex items-center",children:[(0,b.jsx)("input",{type:"radio",value:"boleto",checked:"boleto"===x.payment_method,onChange:a=>y(b=>({...b,payment_method:a.target.value})),className:"mr-2"}),"Boleto Bancário"]}),(0,b.jsxs)("label",{className:"flex items-center",children:[(0,b.jsx)("input",{type:"radio",value:"pix",checked:"pix"===x.payment_method,onChange:a=>y(b=>({...b,payment_method:a.target.value})),className:"mr-2"}),"PIX"]}),(0,b.jsxs)("label",{className:"flex items-center",children:[(0,b.jsx)("input",{type:"radio",value:"cartao",checked:"cartao"===x.payment_method,onChange:a=>y(b=>({...b,payment_method:a.target.value})),className:"mr-2"}),"Cartão de Crédito"]})]})]}),(0,b.jsxs)("div",{className:"bg-white p-6 rounded-lg shadow-sm",children:[(0,b.jsx)("h2",{className:"text-lg font-medium text-gray-900 mb-4",children:"Observações"}),(0,b.jsx)("textarea",{value:x.notes,onChange:a=>y(b=>({...b,notes:a.target.value})),className:"w-full border border-gray-300 rounded px-3 py-2 h-24",placeholder:"Observações adicionais sobre o pedido"})]})]}),(0,b.jsxs)("div",{className:"space-y-6",children:[(0,b.jsxs)("div",{className:"bg-white p-6 rounded-lg shadow-sm",children:[(0,b.jsx)("h2",{className:"text-lg font-medium text-gray-900 mb-4",children:"Itens do Pedido"}),(0,b.jsx)("div",{className:"space-y-4",children:m.map(a=>(0,b.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,b.jsx)("div",{className:"w-16 h-16 flex-shrink-0",children:a.product.image_url?(0,b.jsx)("img",{src:a.product.image_url,alt:a.product.name,className:"w-full h-full object-cover rounded"}):(0,b.jsx)("div",{className:"w-full h-full bg-gray-100 rounded flex items-center justify-center",children:(0,b.jsx)("span",{className:"text-gray-400 text-xs",children:"Sem imagem"})})}),(0,b.jsxs)("div",{className:"flex-1",children:[(0,b.jsx)("h3",{className:"text-sm font-medium text-gray-900",children:a.product.name}),(0,b.jsx)("p",{className:"text-sm text-gray-600",children:a.product.brand||"Marca"}),(0,b.jsxs)("p",{className:"text-sm text-gray-600",children:["Qtd: ",a.quantity]})]}),(0,b.jsx)("div",{className:"text-right",children:(0,b.jsxs)("p",{className:"text-sm font-medium text-gray-900",children:["R$ ",(a.product.price*a.quantity).toFixed(2)]})})]},a.product.id))})]}),(0,b.jsxs)("div",{className:"bg-white p-6 rounded-lg shadow-sm",children:[(0,b.jsx)("h2",{className:"text-lg font-medium text-gray-900 mb-4",children:"Resumo do Pedido"}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,b.jsxs)("span",{className:"text-gray-600",children:["Subtotal (",F()," itens)"]}),(0,b.jsxs)("span",{className:"text-gray-900",children:["R$ ",E().toFixed(2)]})]}),(0,b.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,b.jsx)("span",{className:"text-gray-600",children:"Frete"}),(0,b.jsx)("span",{className:"text-green-600",children:"Grátis"})]}),(0,b.jsx)("div",{className:"border-t border-gray-200 pt-2",children:(0,b.jsxs)("div",{className:"flex justify-between text-lg font-medium",children:[(0,b.jsx)("span",{className:"text-gray-900",children:"Total"}),(0,b.jsxs)("span",{className:"text-gray-900",children:["R$ ",E().toFixed(2)]})]})})]}),(0,b.jsxs)("div",{className:"space-y-3",children:[(0,b.jsx)("button",{type:"button",className:"w-full bg-gray-600 text-white py-3 px-4 rounded-lg text-sm font-medium hover:bg-gray-700 transition-colors",style:{backgroundColor:o?.secondary_color||"#6B7280"},children:"Continuar Pedido"}),(0,b.jsx)("button",{type:"submit",disabled:s,className:"w-full bg-blue-600 text-white py-3 px-4 rounded-lg text-sm font-medium hover:bg-blue-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",style:{backgroundColor:o?.primary_color||"#3B82F6"},children:s?(0,b.jsxs)("div",{className:"flex items-center justify-center",children:[(0,b.jsx)("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"}),"Processando..."]}):"Finalizar Pedido"})]})]})]})]})]})]}):(0,b.jsx)("div",{className:"min-h-screen bg-gray-100",children:(0,b.jsx)("div",{className:"max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:(0,b.jsxs)("div",{className:"text-center py-16",children:[(0,b.jsx)(k.ShoppingCart,{className:"h-24 w-24 text-gray-300 mx-auto mb-4"}),(0,b.jsx)("h3",{className:"text-xl font-medium text-gray-900 mb-2",children:"Carrinho vazio"}),(0,b.jsx)("p",{className:"text-gray-600 mb-6",children:"Adicione produtos ao carrinho antes de finalizar o pedido."}),(0,b.jsx)("button",{onClick:()=>w.push("/"),className:"bg-blue-600 text-white px-6 py-3 rounded-lg hover:bg-blue-700 transition-colors",style:{backgroundColor:o?.primary_color||"#3B82F6"},children:"Voltar ao Catálogo"})]})})})}a.s(["default",()=>l])}];

//# sourceMappingURL=src_app_checkout_page_tsx_3300a33b._.js.map