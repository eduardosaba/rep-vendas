{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 46, "column": 0}, "map": {"version":3,"sources":["file:///A:/RepVendas/src/lib/supabaseClient.ts"],"sourcesContent":["import { createClient } from '@supabase/supabase-js'\r\n\r\nconst supabaseUrl: string = process.env.NEXT_PUBLIC_SUPABASE_URL || 'YOUR_SUPABASE_URL'\r\nconst supabaseAnonKey: string = process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY || 'YOUR_SUPABASE_ANON_KEY'\r\n\r\nexport const supabase = createClient(supabaseUrl, supabaseAnonKey)"],"names":[],"mappings":";;;;AAAA;;AAEA,MAAM,cAAsB,gFAAwC;AACpE,MAAM,kBAA0B,wPAA6C;AAEtE,MAAM,WAAW,IAAA,mRAAY,EAAC,aAAa","debugId":null}},
    {"offset": {"line": 59, "column": 0}, "map": {"version":3,"sources":["file:///A:/RepVendas/src/app/api/send-email/route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from 'next/server'\r\nimport { supabase } from '../../../lib/supabaseClient'\r\n\r\nexport async function POST(request: NextRequest) {\r\n  try {\r\n    const { to, subject, html, text, userId } = await request.json()\r\n\r\n    // Valida√ß√£o b√°sica\r\n    if (!to || !subject || (!html && !text)) {\r\n      return NextResponse.json(\r\n        { error: 'Campos obrigat√≥rios: to, subject, html ou text' },\r\n        { status: 400 }\r\n      )\r\n    }\r\n\r\n    // Buscar configura√ß√µes de email do usu√°rio\r\n    let settings = null\r\n    if (userId) {\r\n      const { data } = await supabase\r\n        .from('settings')\r\n        .select('email_provider, email_api_key, email_from')\r\n        .eq('user_id', userId)\r\n        .single()\r\n\r\n      settings = data\r\n    }\r\n\r\n    // Se n√£o encontrou configura√ß√µes, usar valores padr√£o ou simular\r\n    const emailProvider = settings?.email_provider || 'resend'\r\n    const apiKey = settings?.email_api_key\r\n    const fromEmail = settings?.email_from || 'noreply@repvendas.com'\r\n\r\n    // Se n√£o h√° chave API configurada, simular envio\r\n    if (!apiKey) {\r\n      console.log('üìß Email simulado (sem chave API configurada):', {\r\n        from: fromEmail,\r\n        to,\r\n        subject,\r\n        html: html?.substring(0, 100) + '...',\r\n        text: text?.substring(0, 100) + '...',\r\n        provider: emailProvider,\r\n        timestamp: new Date().toISOString()\r\n      })\r\n\r\n      return NextResponse.json({\r\n        success: true,\r\n        message: 'Email enviado com sucesso (simulado - configure chave API para envio real)',\r\n        messageId: `sim_${Date.now()}`\r\n      })\r\n    }\r\n\r\n    // Integra√ß√£o real com provedores de email\r\n    let result\r\n\r\n    switch (emailProvider) {\r\n      case 'resend':\r\n        result = await sendWithResend(apiKey, fromEmail, to, subject, html, text)\r\n        break\r\n      case 'sendgrid':\r\n        result = await sendWithSendGrid(apiKey, fromEmail, to, subject, html, text)\r\n        break\r\n      case 'mailgun':\r\n        result = await sendWithMailgun(apiKey, fromEmail, to, subject, html, text)\r\n        break\r\n      default:\r\n        // Fallback para simula√ß√£o\r\n        console.log('üìß Email enviado (provedor n√£o suportado):', {\r\n          provider: emailProvider,\r\n          from: fromEmail,\r\n          to,\r\n          subject,\r\n          timestamp: new Date().toISOString()\r\n        })\r\n        return NextResponse.json({\r\n          success: true,\r\n          message: `Email enviado via ${emailProvider} (simulado)`,\r\n          messageId: `prov_${Date.now()}`\r\n        })\r\n    }\r\n\r\n    if (result.success) {\r\n      return NextResponse.json({\r\n        success: true,\r\n        message: 'Email enviado com sucesso',\r\n        messageId: result.messageId\r\n      })\r\n    } else {\r\n      throw new Error(result.error)\r\n    }\r\n\r\n  } catch (error) {\r\n    console.error('Erro ao enviar email:', error)\r\n    return NextResponse.json(\r\n      { error: 'Erro interno do servidor' },\r\n      { status: 500 }\r\n    )\r\n  }\r\n}\r\n\r\n// Fun√ß√£o para envio via Resend\r\nasync function sendWithResend(apiKey: string, from: string, to: string, subject: string, html?: string, text?: string) {\r\n  try {\r\n    const response = await fetch('https://api.resend.com/emails', {\r\n      method: 'POST',\r\n      headers: {\r\n        'Authorization': `Bearer ${apiKey}`,\r\n        'Content-Type': 'application/json'\r\n      },\r\n      body: JSON.stringify({\r\n        from,\r\n        to: [to],\r\n        subject,\r\n        html,\r\n        text\r\n      })\r\n    })\r\n\r\n    const data = await response.json()\r\n\r\n    if (!response.ok) {\r\n      throw new Error(data.message || 'Erro no Resend')\r\n    }\r\n\r\n    return { success: true, messageId: data.id }\r\n  } catch (error) {\r\n    return { success: false, error: (error as Error).message }\r\n  }\r\n}\r\n\r\n// Fun√ß√£o para envio via SendGrid\r\nasync function sendWithSendGrid(apiKey: string, from: string, to: string, subject: string, html?: string, text?: string) {\r\n  try {\r\n    const response = await fetch('https://api.sendgrid.com/v3/mail/send', {\r\n      method: 'POST',\r\n      headers: {\r\n        'Authorization': `Bearer ${apiKey}`,\r\n        'Content-Type': 'application/json'\r\n      },\r\n      body: JSON.stringify({\r\n        personalizations: [{\r\n          to: [{ email: to }]\r\n        }],\r\n        from: { email: from },\r\n        subject,\r\n        content: [\r\n          ...(text ? [{ type: 'text/plain', value: text }] : []),\r\n          ...(html ? [{ type: 'text/html', value: html }] : [])\r\n        ]\r\n      })\r\n    })\r\n\r\n    if (!response.ok) {\r\n      const error = await response.text()\r\n      throw new Error(error || 'Erro no SendGrid')\r\n    }\r\n\r\n    return { success: true, messageId: response.headers.get('x-message-id') || `sg_${Date.now()}` }\r\n  } catch (error) {\r\n    return { success: false, error: (error as Error).message }\r\n  }\r\n}\r\n\r\n// Fun√ß√£o para envio via Mailgun\r\nasync function sendWithMailgun(apiKey: string, from: string, to: string, subject: string, html?: string, text?: string) {\r\n  try {\r\n    const domain = from.split('@')[1] // Extrair dom√≠nio do email\r\n    const response = await fetch(`https://api.mailgun.net/v3/${domain}/messages`, {\r\n      method: 'POST',\r\n      headers: {\r\n        'Authorization': `Basic ${Buffer.from(`api:${apiKey}`).toString('base64')}`,\r\n        'Content-Type': 'application/x-www-form-urlencoded'\r\n      },\r\n      body: new URLSearchParams({\r\n        from,\r\n        to,\r\n        subject,\r\n        ...(text && { text }),\r\n        ...(html && { html })\r\n      })\r\n    })\r\n\r\n    const data = await response.json()\r\n\r\n    if (!response.ok) {\r\n      throw new Error(data.message || 'Erro no Mailgun')\r\n    }\r\n\r\n    return { success: true, messageId: data.id }\r\n  } catch (error) {\r\n    return { success: false, error: (error as Error).message }\r\n  }\r\n}"],"names":[],"mappings":"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","debugId":null}}]
}