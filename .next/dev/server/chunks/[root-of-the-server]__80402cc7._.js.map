{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 46, "column": 0}, "map": {"version":3,"sources":["file:///A:/RepVendas/src/app/api/notifications/route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from 'next/server'\r\nimport { supabase } from '../../../lib/supabaseClient'\r\n\r\n// Simula√ß√£o de notifica√ß√µes em mem√≥ria (em produ√ß√£o, use Redis ou database)\r\nlet notifications: any[] = []\r\n\r\nexport async function GET(request: NextRequest) {\r\n  try {\r\n    const { searchParams } = new URL(request.url)\r\n    const userId = searchParams.get('userId')\r\n\r\n    if (!userId) {\r\n      return NextResponse.json({ error: 'userId √© obrigat√≥rio' }, { status: 400 })\r\n    }\r\n\r\n    // Filtrar notifica√ß√µes do usu√°rio\r\n    const userNotifications = notifications.filter(n => n.userId === userId)\r\n\r\n    return NextResponse.json({\r\n      notifications: userNotifications,\r\n      unreadCount: userNotifications.filter(n => !n.read).length\r\n    })\r\n\r\n  } catch (error) {\r\n    console.error('Erro ao buscar notifica√ß√µes:', error)\r\n    return NextResponse.json({ error: 'Erro interno do servidor' }, { status: 500 })\r\n  }\r\n}\r\n\r\nexport async function POST(request: NextRequest) {\r\n  try {\r\n    const { userId, title, message, type = 'info', data } = await request.json()\r\n\r\n    if (!userId || !title || !message) {\r\n      return NextResponse.json(\r\n        { error: 'Campos obrigat√≥rios: userId, title, message' },\r\n        { status: 400 }\r\n      )\r\n    }\r\n\r\n    const notification = {\r\n      id: `notif_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`,\r\n      userId,\r\n      title,\r\n      message,\r\n      type, // 'info', 'success', 'warning', 'error'\r\n      data,\r\n      read: false,\r\n      createdAt: new Date().toISOString()\r\n    }\r\n\r\n    notifications.push(notification)\r\n\r\n    // Manter apenas as √∫ltimas 100 notifica√ß√µes por usu√°rio\r\n    const userNotifications = notifications.filter(n => n.userId === userId)\r\n    if (userNotifications.length > 100) {\r\n      const oldestNotifications = userNotifications\r\n        .sort((a, b) => new Date(a.createdAt).getTime() - new Date(b.createdAt).getTime())\r\n        .slice(0, userNotifications.length - 100)\r\n\r\n      notifications = notifications.filter(n => !oldestNotifications.includes(n))\r\n    }\r\n\r\n    console.log('üîî Notifica√ß√£o criada:', notification)\r\n\r\n    return NextResponse.json({\r\n      success: true,\r\n      notification\r\n    })\r\n\r\n  } catch (error) {\r\n    console.error('Erro ao criar notifica√ß√£o:', error)\r\n    return NextResponse.json({ error: 'Erro interno do servidor' }, { status: 500 })\r\n  }\r\n}\r\n\r\nexport async function PATCH(request: NextRequest) {\r\n  try {\r\n    const { notificationId, userId } = await request.json()\r\n\r\n    if (!notificationId || !userId) {\r\n      return NextResponse.json(\r\n        { error: 'Campos obrigat√≥rios: notificationId, userId' },\r\n        { status: 400 }\r\n      )\r\n    }\r\n\r\n    const notificationIndex = notifications.findIndex(\r\n      n => n.id === notificationId && n.userId === userId\r\n    )\r\n\r\n    if (notificationIndex === -1) {\r\n      return NextResponse.json({ error: 'Notifica√ß√£o n√£o encontrada' }, { status: 404 })\r\n    }\r\n\r\n    notifications[notificationIndex].read = true\r\n\r\n    return NextResponse.json({\r\n      success: true,\r\n      notification: notifications[notificationIndex]\r\n    })\r\n\r\n  } catch (error) {\r\n    console.error('Erro ao marcar notifica√ß√£o como lida:', error)\r\n    return NextResponse.json({ error: 'Erro interno do servidor' }, { status: 500 })\r\n  }\r\n}"],"names":[],"mappings":"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","debugId":null}}]
}